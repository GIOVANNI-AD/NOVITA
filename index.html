<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Catalogo + Carrello (Demo)</title>
  <style>
    :root {
      --bg:#0b0c10;
      --card:#111319;
      --muted:#a9b0c0;
      --text:#eef1f7;
      --accent:#38bdf8;
      --border: rgba(255,255,255,0.10);
    }
    * { box-sizing: border-box; }
    body {
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 10% 0%, rgba(56,189,248,0.16), transparent 60%),
                  radial-gradient(900px 600px at 90% 10%, rgba(34,197,94,0.10), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    header {
      position: sticky; top:0; z-index: 10;
      backdrop-filter: blur(10px);
      background: rgba(11,12,16,0.72);
      border-bottom: 1px solid var(--border);
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 14px 16px; }
    .topbar { display:flex; gap:12px; align-items:center; justify-content:space-between; }
    .brand { display:flex; gap:10px; align-items:center; }
    .dot { width:10px; height:10px; border-radius:99px; background: var(--accent); box-shadow: 0 0 18px rgba(56,189,248,0.7); }
    h1 { margin:0; font-size: 16px; letter-spacing: .2px; }
    .sub { margin:0; font-size: 12px; color: var(--muted); }
    .actions { display:flex; gap:10px; align-items:center; }
    .btn {
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
    }
    .btn:hover { background: rgba(255,255,255,0.10); }
    .btn.primary { border-color: rgba(56,189,248,0.45); background: rgba(56,189,248,0.12); }
    .pill {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      color: var(--muted);
    }
    main .wrap { padding-top: 18px; padding-bottom: 28px; }
    .controls {
      display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
      margin-bottom: 14px;
    }
    .search {
      flex:1; min-width: 220px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      outline: none;
    }
    .grid {
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }
    @media (max-width: 900px) { .grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (max-width: 560px) { .grid { grid-template-columns: 1fr; } }
    .card {
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.03));
      border-radius: 18px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 420px;
    }
    .imgbox {
      background: rgba(255,255,255,0.03);
      border-bottom: 1px solid var(--border);
      height: 240px;
      display:flex; align-items:center; justify-content:center;
      padding: 10px;
      cursor: zoom-in;
    }
    .imgbox img { max-height: 100%; max-width: 100%; object-fit: contain; }
    .content { padding: 12px 12px 14px; display:flex; flex-direction:column; gap:10px; flex:1; }
    .row { display:flex; gap:10px; align-items:flex-start; justify-content:space-between; }
    .code { font-weight: 800; letter-spacing: .5px; }
    .name { color: var(--muted); font-size: 12px; line-height: 1.3; }
    .meta { display:flex; gap:8px; flex-wrap:wrap; }
    .meta .tag {
      font-size: 12px;
      border: 1px solid var(--border);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.18);
    }
    .price { font-weight: 800; }
    .qty {
      display:flex; gap:8px; align-items:center;
    }
    .qty input {
      width: 86px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      padding: 10px 10px;
      border-radius: 12px;
      outline: none;
      font-weight: 700;
    }
    .muted { color: var(--muted); font-size: 12px; }
    /* Drawer */
    .drawer {
      position: fixed; right: 0; top: 0; height: 100%; width: min(520px, 92vw);
      background: rgba(17,19,25,0.92);
      border-left: 1px solid var(--border);
      backdrop-filter: blur(14px);
      transform: translateX(102%);
      transition: transform .25s ease;
      z-index: 30;
      display:flex; flex-direction:column;
    }
    .drawer.open { transform: translateX(0); }
    .drawer header {
      position: static;
      background: transparent;
      border-bottom: 1px solid var(--border);
    }
    .drawer .wrap { padding: 14px 14px; }
    .drawer h2 { margin: 0; font-size: 15px; }
    .cartlist { padding: 10px 14px 0; overflow:auto; flex:1; }
    .item {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 10px;
      display:flex; gap:10px;
      margin-bottom: 10px;
      background: rgba(255,255,255,0.04);
    }
    .item img { width: 64px; height: 64px; object-fit: contain; background: rgba(255,255,255,0.03); border-radius: 12px; }
    .item .info { flex:1; }
    .item .info .title { font-weight: 800; }
    .item .info .small { font-size: 12px; color: var(--muted); margin-top: 2px; }
    .item .right { display:flex; flex-direction:column; gap:6px; align-items:flex-end; }
    .item .right input {
      width: 82px; text-align:right;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 12px;
      outline:none;
      font-weight: 800;
    }
    .remove { font-size: 12px; color: #fca5a5; cursor:pointer; user-select:none; }
    .footer {
      border-top: 1px solid var(--border);
      padding: 12px 14px 16px;
    }
    .totals { display:flex; justify-content:space-between; align-items:flex-start; gap:10px; margin-bottom: 10px; }
    .totals .big { font-weight: 900; font-size: 16px; }
    textarea {
      width: 100%;
      min-height: 110px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.05);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      outline:none;
      resize: vertical;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      line-height: 1.35;
    }
    .backdrop {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.45);
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease;
      z-index: 25;
    }
    .backdrop.show { opacity: 1; pointer-events: auto; }
    /* Modal gallery */
    .modal {
      position: fixed; inset: 0;
      display:none;
      z-index: 40;
    }
    .modal.show { display:flex; }
    .modal .mback { position:absolute; inset:0; background: rgba(0,0,0,0.65); }
    .modal .panel {
      position: relative;
      margin: auto;
      width: min(920px, 95vw);
      height: min(680px, 92vh);
      border: 1px solid var(--border);
      background: rgba(17,19,25,0.94);
      border-radius: 18px;
      overflow:hidden;
      display:flex; flex-direction:column;
      backdrop-filter: blur(16px);
    }
    .panel .phead {
      display:flex; justify-content:space-between; align-items:center;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
    }
    .panel .pbody { display:flex; gap: 10px; padding: 10px; flex:1; overflow:hidden; }
    .bigimg { flex:1; display:flex; align-items:center; justify-content:center; background: rgba(255,255,255,0.03); border-radius: 14px; overflow:hidden; }
    .bigimg img { max-width: 100%; max-height: 100%; object-fit: contain; }
    .thumbs { width: 120px; overflow:auto; display:flex; flex-direction:column; gap:8px; }
    .thumbs img {
      width: 100%;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      cursor: pointer;
      opacity: .9;
    }
    .thumbs img.active { border-color: rgba(56,189,248,0.7); opacity: 1; }
  
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(17,19,25,0.92);
      border: 1px solid var(--border);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 700;
      font-size: 13px;
      color: var(--text);
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s ease, transform .2s ease;
      z-index: 60;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-6px);
    }
    
  </style>
</head>
<body>
  <header>
    <div class="wrap topbar">
      <div class="brand">
        <span class="dot"></span>
        <div>
          <h1>Catalogo + Carrello (Demo)</h1>
          <p class="sub">Ordine via WhatsApp in formato ‚ÄúCODICE x CARTONI‚Äù</p>
        </div>
      </div>
      <div class="actions">
        <span class="pill" id="countPill">0 articoli</span>
        <button class="btn primary" id="openCartBtn">üõí</button>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div class="controls">
        <input class="search" id="search" placeholder="Cerca per codice o descrizione‚Ä¶" />
        <span class="muted">Prezzi: per cartone ‚Ä¢ CT = pezzi per cartone</span>
      </div>

      <div class="grid" id="grid"></div>
    </div>
  </main>

  <div class="backdrop" id="backdrop"></div>

  <aside class="drawer" id="drawer">
    <header>
      <div class="wrap topbar">
        <div class="brand">
          <span class="dot"></span>
          <div>
            <h2>üõí</h2>
            <p class="sub" id="cartSub">0 righe</p>
          </div>
        </div>
        <div class="actions">
          <button class="btn" id="clearBtn">Svuota</button>
          <button class="btn" id="closeCartBtn">Chiudi</button>
        </div>
      </div>
    </header>

    <div class="cartlist" id="cartlist"></div>

    <div class="footer">
      <div class="totals">
        <div>
          <div class="muted">Totale cartoni</div>
          <div class="big" id="totCartoni">0</div>
        </div>
        <div style="text-align:right">
          <div class="muted">Totale ‚Ç¨</div>
          <div class="big" id="totEuro">0,00</div>
        </div>
      </div>

      <div style="display:flex; gap:10px; margin-bottom:10px; flex-wrap:wrap;">
        <input class="search" id="cliente" placeholder="Nome cliente (facoltativo)" style="flex:1; min-width: 200px;" />
        <input class="search" id="data" placeholder="Data" style="width: 140px;" value="25/12/2025" />
      </div>

      <textarea id="waText" readonly></textarea>

      <div style="display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;">
        <button class="btn" id="copyBtn">Copia testo</button>
        <button class="btn primary" id="waBtn">Invia ordine</button>
      </div>

      <p class="muted" style="margin:10px 0 0;">
        Suggerimento: invia al cliente anche le immagini del catalogo o il PDF, poi lui risponde con i codici.
      </p>
    </div>
  </aside>

  <div class="toast" id="toast">Aggiunto al carrello ‚úÖ</div>

  <div class="modal" id="modal">
    <div class="mback" id="mback"></div>
    <div class="panel">
      <div class="phead">
        <div style="font-weight:900" id="mTitle">Immagini</div>
        <button class="btn" id="mClose">Chiudi</button>
      </div>
      <div class="pbody">
        <div class="bigimg"><img id="mBig" alt=""></div>
        <div class="thumbs" id="mThumbs"></div>
      </div>
    </div>
  </div>

<script>
const PRODUCTS = [{"code": "83493", "name": "Ventilatore a torre con controller a distanza e timer-35 W / alimentazione 220-240 V / diam. cm. 21,5 x h. cm. 85", "ct": "1 Pz", "price": 24.08, "images": ["assets/img/83493.jpg", "assets/img/83493eff01.jpg", "assets/img/83493eff02.jpg"], "mainImage": "assets/img/83493.jpg"}, {"code": "83495", "name": "Ventilatore a torre con controller a distanza e timer-35 W / alimentazione 220-240 V / diam. cm. 34 x h. cm. 110", "ct": "1 Pz", "price": 32.1, "images": ["assets/img/83495.jpg", "assets/img/83495eff01.jpg"], "mainImage": "assets/img/83495.jpg"}, {"code": "100383", "name": "Macchina per popcorn elettrica-1.200 W / alimentazione 230 V / capienza: gr. 60 - diam. cm. 16 x h. cm. 31", "ct": "6 Pz", "price": 10.4, "images": ["assets/img/100383.jpg", "assets/img/100383eff.jpg"], "mainImage": "assets/img/100383.jpg"}, {"code": "100384", "name": "Macchina per popcorn elettrica-1.200 W / alimentazione 230 V / capienza: gr. 60 - cm. 17 x 23,5 x h. cm. 39", "ct": "4 Pz", "price": 17.54, "images": ["assets/img/100384.jpg", "assets/img/100384eff.jpg"], "mainImage": "assets/img/100384.jpg"}, {"code": "100385", "name": "Macchina per popcorn elettrica-300 W / alimentazione 230 V / capienza: gr. 100 - cm. 25,5 x 28,5 x h. cm. 47", "ct": "2 Pz", "price": 43.7, "images": ["assets/img/100385.jpg"], "mainImage": "assets/img/100385.jpg"}];

const euro = (n) => (n ?? 0).toLocaleString('it-IT', {minimumFractionDigits:2, maximumFractionDigits:2});
const cartKey = "catalogo_cart_demo_v1";

function loadCart() {
  try { return JSON.parse(localStorage.getItem(cartKey) || "{}"); } catch(e) { return {}; }
}
function saveCart(c) { localStorage.setItem(cartKey, JSON.stringify(c)); }

let cart = loadCart();
let toastTimer = null;
function showToast(msg){
  const t = document.getElementById('toast');
  if(!t) return;
  t.textContent = msg || "Aggiunto al carrello ‚úÖ";
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>t.classList.remove('show'), 1200);
}


const grid = document.getElementById('grid');
const search = document.getElementById('search');
const countPill = document.getElementById('countPill');

function matches(p, q) {
  if(!q) return true;
  q = q.toLowerCase();
  return p.code.toLowerCase().includes(q) || p.name.toLowerCase().includes(q);
}

function renderGrid() {
  const q = search.value.trim();
  const list = PRODUCTS.filter(p => matches(p, q));
  countPill.textContent = `${list.length} articoli`;
  grid.innerHTML = "";
  for (const p of list) {
    const card = document.createElement('div');
    card.className = "card";
    card.innerHTML = `
      <div class="imgbox" title="Apri immagini">
        <img src="${p.mainImage}" alt="${p.code}">
      </div>
      <div class="content">
        <div class="row">
          <div>
            <div class="code">COD. ${p.code}</div>
            <div class="name">${p.name}</div>
          </div>
          <div class="price">‚Ç¨ ${euro(p.price)}</div>
        </div>
        <div class="meta">
          <span class="tag">CT: ${p.ct}</span>
          <span class="tag">Prezzo/cartone</span>
        </div>
        <div style="margin-top:auto; display:flex; gap:10px; align-items:flex-end; justify-content:space-between;">
          <div class="qty">
            <div>
              <div class="muted">Cartoni</div>
              <input type="number" min="1" step="1" value="1" inputmode="numeric" />
            </div>
          </div>
          <button class="btn primary">Aggiungi</button>
        </div>
      </div>
    `;
    const imgbox = card.querySelector('.imgbox');
    imgbox.addEventListener('click', () => openModal(p));
    const qtyInput = card.querySelector('input');
    const addBtn = card.querySelector('button.btn.primary');
    addBtn.addEventListener('click', () => {
      const qta = Math.max(1, parseInt(qtyInput.value || "1", 10));
      cart[p.code] = (cart[p.code] || 0) + qta;
      saveCart(cart);
      renderCart();
      showToast(`COD. ${p.code} aggiunto ‚úÖ`);
      // Non aprire automaticamente il carrello: l'utente lo apre quando vuole
    });
    grid.appendChild(card);
  }
}

const drawer = document.getElementById('drawer');
const backdrop = document.getElementById('backdrop');
document.getElementById('openCartBtn').addEventListener('click', () => openCart());
document.getElementById('closeCartBtn').addEventListener('click', closeCart);
backdrop.addEventListener('click', closeCart);

function openCart() {
  drawer.classList.add('open');
  backdrop.classList.add('show');
}
function closeCart() {
  drawer.classList.remove('open');
  backdrop.classList.remove('show');
}

document.getElementById('clearBtn').addEventListener('click', () => {
  cart = {};
  saveCart(cart);
  renderCart();
});

const cartlist = document.getElementById('cartlist');
const cartSub = document.getElementById('cartSub');
const totCartoni = document.getElementById('totCartoni');
const totEuro = document.getElementById('totEuro');
const waText = document.getElementById('waText');
const cliente = document.getElementById('cliente');
const data = document.getElementById('data');

function cartLines() {
  const lines = [];
  for (const [code, qty] of Object.entries(cart)) {
    if(qty <= 0) continue;
    lines.push({code, qty});
  }
  // stable order
  lines.sort((a,b) => a.code.localeCompare(b.code));
  return lines;
}

function buildWhatsAppText() {
  const lines = cartLines();
  const c = cliente.value.trim();
  const d = data.value.trim();
  let out = `üì¶ ORDINE CATALOGO${c ? " ‚Äì " + c : ""}${d ? " ‚Äì " + d : ""}\n\n`;
  out += "Indicare CODICE x CARTONI\n\n";
  for (const l of lines) out += `${l.code} x ${l.qty}\n`;
  out += "\n‚òëÔ∏è Confermo l‚Äôordine";
  return out;
}

function renderCart() {
  const lines = cartLines();
  cartSub.textContent = `${lines.length} righe`;

  cartlist.innerHTML = "";
  let totalCartoni = 0;
  let totalEuro = 0;

  for (const l of lines) {
    const p = PRODUCTS.find(x => x.code === l.code);
    if(!p) continue;

    totalCartoni += l.qty;
    totalEuro += (p.price || 0) * l.qty;

    const el = document.createElement('div');
    el.className = "item";
    el.innerHTML = `
      <img src="${p.mainImage}" alt="${p.code}">
      <div class="info">
        <div class="title">COD. ${p.code}</div>
        <div class="small">${p.name}</div>
        <div class="small">CT: ${p.ct} ‚Ä¢ ‚Ç¨ ${euro(p.price)} / cartone</div>
      </div>
      <div class="right">
        <input type="number" min="1" step="1" value="${l.qty}" />
        <div class="remove">Rimuovi</div>
      </div>
    `;
    const qInput = el.querySelector('input');
    qInput.addEventListener('input', () => {
      const v = Math.max(1, parseInt(qInput.value || "1", 10));
      cart[p.code] = v;
      saveCart(cart);
      renderCart();
    });
    el.querySelector('.remove').addEventListener('click', () => {
      delete cart[p.code];
      saveCart(cart);
      renderCart();
    });

    cartlist.appendChild(el);
  }

  totCartoni.textContent = totalCartoni.toString();
  totEuro.textContent = euro(totalEuro);
  waText.value = buildWhatsAppText();
}

cliente.addEventListener('input', () => waText.value = buildWhatsAppText());
data.addEventListener('input', () => waText.value = buildWhatsAppText());

document.getElementById('copyBtn').addEventListener('click', async () => {
  try {
    await navigator.clipboard.writeText(waText.value);
    alert("Testo copiato ‚úÖ");
  } catch(e) {
    // fallback
    waText.select();
    document.execCommand('copy');
    alert("Testo copiato ‚úÖ");
  }
});

document.getElementById('waBtn').addEventListener('click', () => {
  const text = encodeURIComponent(waText.value);
  // wa.me apre WhatsApp (web o app)
  window.open(`https://wa.me/?text=${text}`, "_blank");
});

// Modal gallery
const modal = document.getElementById('modal');
const mback = document.getElementById('mback');
const mClose = document.getElementById('mClose');
const mTitle = document.getElementById('mTitle');
const mBig = document.getElementById('mBig');
const mThumbs = document.getElementById('mThumbs');

function openModal(p) {
  mTitle.textContent = `COD. ${p.code} ‚Äì immagini`;
  modal.classList.add('show');
  mThumbs.innerHTML = "";
  const imgs = p.images && p.images.length ? p.images : [p.mainImage];
  let current = imgs[0];
  mBig.src = current;

  imgs.forEach((src, idx) => {
    const t = document.createElement('img');
    t.src = src;
    if(idx === 0) t.classList.add('active');
    t.addEventListener('click', () => {
      current = src;
      mBig.src = current;
      [...mThumbs.querySelectorAll('img')].forEach(x => x.classList.remove('active'));
      t.classList.add('active');
    });
    mThumbs.appendChild(t);
  });
}

function closeModal() { modal.classList.remove('show'); }
mback.addEventListener('click', closeModal);
mClose.addEventListener('click', closeModal);
document.addEventListener('keydown', (e) => { if(e.key === 'Escape') { closeModal(); closeCart(); } });

search.addEventListener('input', renderGrid);

renderGrid();
renderCart();
</script>
</body>
</html>
